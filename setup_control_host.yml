---
- name: Install requirements
  hosts: localhost
  tasks:
    - name: Install curl, gpg, paramiko
      delegate_to: localhost
      ansible.builtin.apt:
        name:
          - curl
          - gpg
          - python3-paramiko
        state: present
        update_cache: yes
      become: yes
      when: ansible_os_family == "Debian"

- name: Setup Ansible Galaxy roles
  hosts: localhost
  connection: local
  gather_facts: false
  
  tasks:
    - name: Check for requirements.yml
      stat:
        path: "{{ playbook_dir }}/requirements.yml"
      register: req_file
      
    - name: Install Galaxy roles
      command: ansible-galaxy install -r requirements.yml --force
      args:
        chdir: "{{ playbook_dir }}"
      when: req_file.stat.exists
      changed_when: false